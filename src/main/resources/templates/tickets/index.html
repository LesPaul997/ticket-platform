<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:insert="~{fragments/fragments :: head}">
</head>
<body>
	<header th:insert="~{fragments/fragments :: navbar}">
		
	</header>
    
	<main class="container">
		<div class="row">
			<div class="col-12">	
				
				<th:block>
					<h1 class="py-4 mb-2 text-center">
						GESTIONE DEI TICKET
					</h1>
						
								<form th:action="@{/tickets/search}" method="GET" class="col-12 p-4">
										<div class="form-group my-3 row">
											<div class="col-md-8">
												<input name="title" type="text" class="form-control me-2 w-100" id="title-input"
													placeholder="cerca tickets per titolo">
											</div>
											<div class="col-4 ps-0">
												<button type="submit" class="btn btn-success w-100">Cerca Tickets</button>
											</div>
										</div>
								</form>
								<!-- Bottone Creazione -->
								<div class="mb-3 d-flex pe-5">
									<a th:href="@{/tickets/create}" class="ms-auto me-5 btn btn-lg btn-primary">Aggiungi nuovo ticket</a>					
								</div> 
								
					<table class="table table-striped table-hover mt-2">
										<thead>
											<tr>
												<th>ID</th>
												<th>Titolo</th>
												<th>Categoria</th>
												<th>Stato</th>
												<th>Creato il</th>
												<th>Aggiornamenti</th>
												<th class="text-center">Azioni</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="ticket : ${tickets}">
												<td th:text="${ticket.id}" class="fs-3"></td>
												<td th:text="${ticket.title}" class="pt-3"></td>
												<td th:text="${ticket.category}" class="pt-3"></td>
												<td th:text="${ticket.status}" class="pt-3"></td>
												<td th:text="${ticket.getCreatedAt()}" class="pt-3"></td>
												<td th:text="${ticket.getUpdatedAt()}" class="pt-3"></td>
												<td class="text-center">
													<a class="btn btn-sm btn-primary m-1"
														th:href="@{'/tickets/show/{id}'(id=${ticket.id})}"
														role="button">Dettagli</a>
													<a class="btn btn-sm btn-warning m-1"
														th:href="@{'/tickets/edit/{id}'(id=${ticket.id})}"
														role="button">Modifica</a>  
														<th:block sec:authorize="hasAuthority('ADMIN')">
															<!-- Button trigger modal -->
															<button type="button" class="btn btn-sm btn-danger m-1" data-bs-toggle="modal"
																th:data-bs-target="'#delete-' + ${ticket.id}">
																Cancella
															</button>
															<!-- Modal -->
															<div class="modal fade" th:id="'delete-' + ${ticket.id}" tabindex="-1"
																aria-labelledby="exampleModalLabel" aria-hidden="true">
																<div class="modal-dialog">
																	<div class="modal-content">
																		<div class="modal-header">
																			<h1 class="modal-title fs-5" id="exampleModalLabel">Conferma
																				cancellazione</h1>
																			<button type="button" class="btn-close" data-bs-dismiss="modal"
																				aria-label="Close"></button>
																		</div>
																		<div class="modal-body text-center">
																			Sei sicuro di voler eliminare il ticket [[ ${ticket.title} ]]?
																		</div>
																		<div class="modal-footer">
																			<button type="button" class="btn btn-secondary"
																				data-bs-dismiss="modal">Annulla</button>
																			<form class="d-inline-block"
																				th:action="@{http://localhost:8080/tickets/delete/{id}(id=${ticket.id})}"
																				method="POST">
																				<button class="btn btn-danger m-1" type="submit"
																					id="submitButton">Conferma</button>
																			</form>
																		</div>
																	</div>
																</div>
															</div>
														</th:block>	
												</td>
											</tr>
										</tbody>
					
				</th:block>	
				
				<!--
				<th:block th:unless="${pizze.size() > 0}">
					<h3 class="py-5 text-center">
						No pizza has been found with query <strong>[[ ${pizzaName} ]]</strong>
					</h3>
				</th:block>
				               -->
			</div>	
		</div>
		
	</main>
	
	<footer th:replace="~{fragments/fragments :: footer}"></footer>
</body>
</html>
